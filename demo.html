<html>
<head>
  <title>Run LLVM Assembly In Your Browser</title>
</head>
<body onload="document.getElementById('the_output').value = ''">
<h2>Run LLVM Assembly In Your Browser</h2>
<p>
  This is a demo of compiling and running <a href="http://llvm.org">LLVM</a> assembly entirely clientside, that is, in JavaScript.
</p>
<p>
  Press the button to see it print "hello, world!" in the output area on the right. Try modifying the LLVM assembly and pressing it again. Note that <a href="http://llvm.org/docs/LangRef.html">LLVM assembly</a> is typed, so if you add characters to the string for example, you will need to adjust its length, both where it is defined and where it is used. If you get errors they will show up in the output area.
</p>
<script src="llvm-as.js"></script>
<script src="llvm-dis.js"></script>
<script>
  function process(input) {
    try {
      return llvmDis(llvmAs(input));
    } catch (e) {
      if (typeof e == 'string') {
        return 'ERROR: ' + e;
      } else {
        throw e;
      }
    }
  }
</script>
<textarea id="the_input" cols=50 rows=22>
; ModuleID = 'tests/hello_world.bc'
target datalayout = "e-p:32:32:32-i1:8:8-i8:8:8-i16:16:16-i32:32:32-i64:32:64-f32:32:32-f64:32:64-v64:64:64-v128:128:128-a0:0:64-f80:32:32-n8:16:32-S128"
target triple = "i386-pc-linux-gnu"

@.str = private unnamed_addr constant [15 x i8] c"hello, world!\0A\00", align 1

define i32 @main() {
entry:
  %retval = alloca i32, align 4
  store i32 0, i32* %retval
  %call = call i32 (i8*, ...)* @printf(i8* getelementptr inbounds ([15 x i8]* @.str, i32 0, i32 0))
  ret i32 1
}

declare i32 @printf(i8*, ...)
</textarea>
<textarea id="the_output" cols=60 rows=22>
</textarea>
<hr>
<script>
  // emscripten stuff
  arguments = [];

  // For compiler
  var compilerOutput = '';
  print = function(x) {
    compilerOutput += x;
  };

  var outputElement = document.getElementById('the_output');
  function execute(ll) {
    compilerOutput = '';
    compile(ll);

    outputElement.value = '';
    var oldPrint = Module.print;
    Module.print = function(x) {
      outputElement.value += x;
    };
    eval(compilerOutput);
    Module.print = oldPrint;
  }

  // For generated code
  var Module = {};
</script>
<script src="compiler.js">
</script>
<script>
  function doItAll() {
    var ll = process(document.getElementById('the_input').value);
    if (ll && ll[0] != 'E') { // E for ERROR
      execute(ll);
    } else {
      outputElement.value = ll; // error message
    }
  }
</script>

<input value="process" type="button" onclick="doItAll()">
<hr>
<p>
  This demo works by using parts of the LLVM toolchain (llvm-dis and llvm-as), compiled by <a href="http://emscripten.org/">emscripten</a> from C++ to JavaScript, to check the assembly for errors and pretty-print it. Then the emscripten compiler (originally written in JavaScript, but ported from the normal batch/shell mode to the browser environment) is run on the output, and the code executed directly.
</p>
<p>
  Note that the generated code is not optimized at all, so benchmarking is pointless. If you want to benchmark, run emscripten normally with <code>-O2</code>. Also, note that this demo has hardly been tested and glues together several codebases in ways they were not originally intended, there might be things that do not work.
</p>
<p>
  This demo was done as a fun hacking project over a holiday vacation.
</p>
</body>
</html>

